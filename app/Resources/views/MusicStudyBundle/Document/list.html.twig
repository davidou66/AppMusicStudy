{% extends 'MusicStudyBundle/base.html.twig' %}

{% block body %}
    {#<script>#}
        {#$( document ).ready(function() {#}
            {#var url =  "{{ url('dashboard') }}".replace("app_dev.php", "");#}
            {#{% for doc in documents %}#}
                {#var path = "{{ vich_uploader_asset(doc, 'file', 'AppBundle\\Entity\\Document') }}";#}
            {#var idDiv = "#dl-link-";#}
            {#var idDivC = idDiv.concat("{{ doc.id }}");#}
                {#$(idDivC).attr("href", url.slice(0,-1) + result['path']);#}
            {#{% endfor %}#}
        {#});#}
        {#function downloadFile(idFile, idUser) {#}
            {#var json = {#}
                {#idFile: idFile,#}
                {#idUser: idUser#}
            {#};#}

            {#$.ajax({#}
                {#method: "POST",#}
                {#url: '{{ path("download_document") }}',#}
                {#data: json,#}
                {#error: function (e) {#}
                    {#console.log(e.responseText);#}
                {#},success: function (result) {#}
                    {#console.log($("#dl-link-"+idFile).attr('href'));#}
                    {#if ($("#dl-link-"+idFile).attr('href') === undefined) {#}
                        {#var url =  "{{ url('dashboard') }}".replace("app_dev.php", "");#}
                        {#$("#dl-link-"+idFile).attr("href", url.slice(0,-1) + result['path']);#}
                        {#$("#dl-link-"+idFile).trigger('click');#}
                    {#}#}
                {#},#}
                {#complete: function () {#}
{#//                    $("#inputqueryprospect").siblings("#trigger_search_option").removeClass("searching");#}
{#//                    $('.prospect-info').removeClass('selected');#}
{#//                    $('#prospect-info-option-'+idProspect).addClass('selected');#}
                {#}#}
            {#})#}
        {#}#}
    {#</script>#}
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                {% if form is not null %}Bibliothèque{% else %}Mes cours{% endif %}
                <small>Documents{% if form is not null %} partagés{% else %} personnels{% endif %}</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="{{ path('dashboard') }}"><i class="fa fa-dashboard"></i> Accueil</a></li>
                <li class="active">Bibliothèque</li>
            </ol>
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="row">
                {% if form is not null %}
                    {{ form_start(form) }}
                    {%  if form_errors(form) %}
                        <div class="error alert alert-warning">
                            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                            {{ form_errors(form) }}
                        </div>
                    {% endif %}


                    <div class="col-md-12">
                        <div class="box box-warning">
                            <div class="box-header with-border">

                                <h3 class="box-title"><i class="fa fa-files-o"></i> Ajouter un document</h3>
                            </div>
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-xs-2">
                                        {{ form_widget(form.fileName, {'attr': {'placeholder': 'Titre'}}) }}
                                    </div>
                                    <div class="col-xs-4">
                                        {{ form_widget(form.description, {'attr': {'placeholder': 'Description'}}) }}
                                    </div>
                                    <div class="col-xs-4">
                                        {{ form_widget(form.file) }}
                                    </div>
                                </div>
                                <div class="row" style="margin-top: 10px">
                                    {% if is_granted("ROLE_ADMIN") %}
                                        <div class="col-xs-2">
                                            {{ form_widget(form.utilisateur) }}
                                        </div>
                                    {% endif %}
                                    <div class="col-xs-2">
                                        {{ form_widget(form.type) }}
                                    </div>

                                    <div class="col-xs-">
                                        {{ form_widget(form.save, {'attr': {'class': 'btn btn-warning'}}) }}
                                    </div>
                                </div>
                            </div>
                            <!-- /.box-body -->
                        </div>
                    </div>
                    {{ form_widget(form._token) }}
                    {{ form_end(form, {'render_rest': false }) }}
                    <!-- /.box -->
                {% endif %}
            </div>
            <div class="row">
                {% if documents is empty %}
                <div class="error-page">
                    {#<h2 class="headline text-yellow">Oops! </h2>#}

                    <div class="error-content">
                        <h3><i class="fa fa-warning text-yellow"></i> Aucun résultat</h3>

                        <p>
                            Aucun document ne vous a été assigné personnellement
                            Vous pouvez vous rendre dans la <a href="{{ path('list_document') }}">BIBLIOTHEQUE </a>pour trouver des documents partagés.
                        </p>
                    </div>
                </div>
                {% else %}
                    {% for doc in documents %}
                        <!-- /.col -->
                        <div class="col-md-3 col-sm-6 col-xs-12">
                            <div class="info-box">
                                <span class="info-box-icon bg-yellow"><a id="dl-link-{{ doc.id }}" href="{{ vich_uploader_asset(doc, 'file', 'MusicStudyBundle\\Entity\\Document') }}" download ><i class="fa fa-files-o"></i></a></span>

                                <div class="info-box-content">
                                    {% if is_granted("ROLE_ADMIN") %}
                                        <span class="info-box-text pull-right"><a href="{{ path('delete_document', {'id': doc.id}) }}"><i class="fa fa-remove"></i></a></span>
                                    {% endif %}
                                    <span class="info-box-text">Nom: {{ doc.fileName }}</span>
                                    <span class="info-box-text">{{ doc.description }}</span>
                                    <span class="info-box-text">Type: {{ doc.type}}</span>
                                    {#<a id="dl-link-{{ doc.id }}"  download><i class="fa fa-download fa-3" aria-hidden="true"></i></a>#}
                                    {#<a id="dl-link-{{ doc.id }}" href="{{ vich_uploader_asset(doc, 'file', 'AppBundle\\Entity\\Document') }}" download ><i class="fa fa-download fa-3" aria-hidden="true"></i></a>#}

                                </div>
                                <!-- /.info-box-content -->
                            </div>
                            <!-- /.info-box -->
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        </section>
    </div>
{% endblock %}